# AmzGen 项目业务逻辑文档

## 1. 项目概述
**AmzGen** 是一款专为电商卖家（特别是亚马逊卖家）设计的 AI 工具，旨在将简单的白底产品照片转化为高质量的生活场景营销图。它利用生成式 AI（Google Gemini）将产品虚拟放置在逼真的场景中，从而消除了昂贵的实体拍摄需求。

## 2. 核心用户工作流
应用程序遵循线性、分步的用户操作流程：

1.  **上传产品 (Upload Product)**：
    *   用户选择一张产品图片（通常是白底的 PNG/JPG）。
    *   **逻辑**：应用立即创建本地预览。可选地（且默认情况下），它会触发背景移除流程，以确保产品能被干净地合成到新场景中。

2.  **配置 (Configuration)**：
    *   **模型选择**：用户选择 AI 模型（例如 Gemini 2.5）。
    *   **场景选择 (预设)**：用户选择一个或多个“场景氛围 (Scenarios/Vibes)”。这些是预定义的提示词模板（例如“极简工作室”、“乡村户外”）。
        *   *多选支持*：用户可以同时选择多个预设，一次性生成一批风格各异的图片。
    *   **附加上下文**：用户可以输入自由文本（例如“在旁边加一杯咖啡”）来定制生成结果。

3.  **触发生成 (Generation Trigger)**：
    *   用户点击“生成 (Generate)”。
    *   系统按顺序或并行处理每个选定的预设（目前实现为循环顺序处理）。

4.  **结果与输出 (Results & Output)**：
    *   生成的图片显示在网格中。
    *   每张卡片展示结果图、使用的“氛围 (vibe)”，并允许下载高清图片。

## 3. 技术逻辑拆解

### A. 图像预处理 (`utils.ts`)
*   **背景移除**：在将图像发送给 AI 进行场景生成之前，系统通常需要移除现有的白色背景，以防止出现“白盒子”伪影。
*   **Base64 转换**：图像被转换为 Base64 字符串，以便传输给 LLM API。

### B. “艺术总监” 代理 (Prompt Engineering)
这是位于 `services/llm/gemini.ts` 中的核心业务逻辑“秘方”。

系统不会直接将原始的预设描述发送给图像生成器，而是采用 **两步 LLM 流程**：

1.  **第一步：提示词扩展 (文本到文本)**
    *   **角色**：LLM 扮演“专业产品摄影艺术总监”。
    *   **输入**：原始预设描述（例如“极简工作室”）+ 用户的自定义上下文。
    *   **目标**：将其重写为适合图像生成模型的高度详细、技术性的提示词。
    *   **约束**：指示其 *仅* 关注背景、灯光、构图和氛围，将输入图像视为“主体”。
    *   **输出**：经过优化的专业提示词（例如“柔和的漫射窗光，大理石台面，景深...”）。

2.  **第二步：场景生成 (图像到图像 / 多模态)**
    *   **输入**：预处理后的产品图像 (Base64) + 第一步生成的 *扩展提示词*。
    *   **逻辑**：LLM (Gemini 2.5) 生成一张新图像，将产品合成到描述的场景中。
    *   **关键参数**：提示词强调“商业广告”质量和“照片级真实感”风格。

### C. 预设管理系统
*   **数据结构**：预设包含 `id`、`name`（名称）和 `description`（描述）。
*   **增删改查 (CRUD)**：用户可以创建新预设、编辑现有预设或删除它们。
*   **存储**：目前在应用状态 (React `useState`) 中管理。*注意：生产版本需要持久化存储（本地存储或后端数据库）。*

### D. API 与安全
*   **客户端密钥管理**：为了保持应用的轻量级和无服务器化（初期），Google Gemini API Key 存储在用户的浏览器 `localStorage` 中。
*   **隐私**：密钥永远不会发送到 AmzGen 拥有的后端服务器；它是直接从客户端浏览器发送到 Google API 的。

## 4. 数据模型 (`types.ts`)

*   **`ScenarioPreset`**：定义可复用的场景模板。
*   **`GeneratedImage`**：代表生成的最终结果，将结果 URL 与生成它的提示词和氛围关联起来。
*   **`ProcessingState`**：跟踪 UI 状态（空闲 -> 扩展提示词 -> 生成中 -> 完成），以便向用户提供细粒度的进度更新。

## 5. 商业价值指标
*   **效率**：批量生成允许在几秒钟内测试多个营销角度。
*   **成本**：UI 中模拟了“积分 (Credits)”（目前是模拟数据），但这代表了一种按生成次数付费的商业模式。
*   **质量控制**：“提示词扩展”步骤确保即使是简单的用户输入也能产生高质量、专业外观的输出结果。

